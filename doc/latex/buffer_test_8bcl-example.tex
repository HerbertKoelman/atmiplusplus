\hypertarget{buffer_test_8bcl-example}{\section{buffer\+\_\+test.\+bcl}
}
A fielded buffers, that contain attribute-\/value pairs called fields.

The attribute is the field’s identifier, and the associated value represents the field’s data content. Fielded buffers provide an excellent structure for communicating parameterized data between cooperating processes, by providing named access to a set of related fields. Programs that need to communicate with other processes can use the F\+M\+L software to provide access to fields without concerning themselves with the structures containing them.

\begin{DoxyAuthor}{Author}
herbert koelman(\href{mailto:herbert.koelman@me.com}{\tt herbert.\+koelman@me.\+com})
\end{DoxyAuthor}

\begin{DoxyCodeInclude}
1 /* $Id$
2 
3    Sample Tuxedo client using ATMI++ libray.
4 
5  */
6 #include <stdlib.h>
7 #include <unistd.h>
8 #include <string.h>
9 #include <string>
10 #include <iostream>
11 #include <fstream>
12 #include <typeinfo>
13 #include "atmi/atmi++.hpp"
14 
15 #include "sample\_fml\_table.h"
16 
17 class buffer\_test : public atmi::abstract\_client \{
18   public:
19     buffer\_test (): atmi::abstract\_client ("btest")\{
20     \};
21 
22     int run ( int argc, char **argv )\{
23       try \{
24 
25         atmi::buffer b (100), a;
26         /*
27            const char *types[5] = \{ typeid(short).name(), typeid(int).name() \};
28            std::cout << "Stored: " << types[0] << std::endl;
29            std::cout << "Stored: " << types[1] << " is a " << std::endl;
30            if(strcmp ( typeid(int).name(), types[1]) == 0 )\{
31            std::cout << "same type int." << std::endl;
32            \}
33            std::cout << "Type id " << typeid(long).name() << std::endl;
34          */
35 
36         std::cout << "atmi::buffer b: " << b.used() << "/" << b.unused() <<", size: " << b.size() << ",
       chksum: " << b.chksum() <<  std::endl;
37 
38         atmi::Tfield<atmi::carray>   unknown\_field;
39         unknown\_field.set\_id(SRVCDAY);
40         unknown\_field.set\_char\_array("salut les amis\(\backslash\)0rray", sizeof ("salut les amis\(\backslash\)0rray"));
41 
42         atmi::Tfield<string> prenom ( EMPNAME );
43         atmi::Tfield<long>   empid ( EMPID );
44         atmi::Tfield<long>   empzip ( EMPZIP );
45         atmi::Tfield<string> nom ( EMPNAME );
46         atmi::Tfield<char *> carray ( SRVCDAY );
47         atmi::Tfield<char *> copy ( SRVCDAY );
48 
49         prenom = "herbert";
50         nom = "this is a char *";
51         empid = 2;
52         carray.set\_char\_array("helloworld\(\backslash\)0rray", strlen ("helloworld\(\backslash\)0rray"));
53         copy = carray;
54 
55         std::cout << "Added fields: " << std::endl;
56         b.add(unknown\_field);
57         b.add ( empid );
58         b.add ( nom );
59         b.add ( prenom );
60         b.add ( carray );
61         b.print ();
62 
63         b.get ( copy );
64 
65         std::cout << copy.what() << std::endl;
66         long len = 5;                  //copy.length();
67         char *cav = new char[len];
68         copy.get\_char\_array ( cav, len );
69         for ( int x = 0; x < len; x++ ) \{
70           std::cout << "'"<< cav[x]<<"',";
71         \}
72         std::cout << std::endl;
73 
74         std::cout << "Setting (update) empid value: " << std::endl;
75         empid = 22;
76         b.set ( empid );
77         b.print ();
78 
79         std::cout << "size : " << b.size();
80         b.pack ();
81         std::cout << ", after pack: " << b.size() << std::endl;
82 
83         std::cout << "atmi::buffer (in the end): " << b.used() << "/" << b.unused() <<", size: " <<
       b.size() << ", chksum: " << b.chksum() <<  std::endl;
84 
85         std::cout << "wrapping atmi::buffer." << std::endl ;
86         atmi::buffer wrapper ( b.get\_buffer());
87         nom = "this was added into a wrapper instance of atmi::buffer.";
88         wrapper.set (nom );
89         wrapper.print ();
90 
91         std::cout << "transforming a atmi::buffer into a wrapped buffer." << std::endl;
92         atmi::buffer wrapper1;
93         wrapper1.set\_buffer ( wrapper.get\_buffer());
94         prenom = "this was set by a wrapper";
95         wrapper1.set ( prenom );
96         wrapper1.print();
97 
98       \}catch ( atmi::buffer\_exception &err ) \{
99         cerr << err.what() << ". Ferror : " << err.error() <<std::endl;
100       \} catch ( atmi::atmi\_exception &err ) \{
101         cerr << err.what() << std::endl;
102       \} catch ( std::exception &err ) \{
103         cerr << err.what() << std::endl;
104       \}
105 
106       return 9999;
107     \}
108 
109 \};
110 
111 // program main -------------------------------------------------
112 
113 int main ( int argc, char **argv ) \{
114 
115   try \{
116 
117     std::cout << "atmi::buffer sample program (" << atmi::cpp\_atmi\_version() <<")." << std::endl;
118     std::cout << "setting up";
119     buffer\_test btest;
120 
121     std::cout << ", starting up" ;
122     btest.run ( argc, argv );
123 
124   \} catch ( atmi::atmi\_exception &err)\{
125     cerr << std::endl << err.what() << std::endl;
126   \} catch ( std::exception &err ) \{
127     cerr << std::endl << err.what() << std::endl;
128   \}
129   std::cout << ", done." << std::endl;
130 
131   return 0;
132 \}
\end{DoxyCodeInclude}
 