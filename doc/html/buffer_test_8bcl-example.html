<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>C++ ATMI wrapper: buffer_test.bcl</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">C++ ATMI wrapper
   &#160;<span id="projectnumber">(v4.3.1)</span>
   </div>
   <div id="projectbrief">Simple C++ wrapper to ATMI functions.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">buffer_test.bcl</div>  </div>
</div><!--header-->
<div class="contents">
<p>A fielded buffers, that contain attribute-value pairs called fields.</p>
<p>The attribute is the field’s identifier, and the associated value represents the field’s data content. Fielded buffers provide an excellent structure for communicating parameterized data between cooperating processes, by providing named access to a set of related fields. Programs that need to communicate with other processes can use the FML software to provide access to fields without concerning themselves with the structures containing them.</p>
<dl class="section author"><dt>Author</dt><dd>herbert koelman(<a href="#" onclick="location.href='mai'+'lto:'+'her'+'be'+'rt.'+'ko'+'elm'+'an'+'@me'+'.c'+'om'; return false;">herbe<span style="display: none;">.nosp@m.</span>rt.k<span style="display: none;">.nosp@m.</span>oelma<span style="display: none;">.nosp@m.</span>n@me<span style="display: none;">.nosp@m.</span>.com</a>)</dd></dl>
<div class="fragment"><div class="line">/* $Id$</div>
<div class="line"></div>
<div class="line">   Sample Tuxedo client using ATMI++ libray.</div>
<div class="line"></div>
<div class="line"> */</div>
<div class="line">#include &lt;stdlib.h&gt;</div>
<div class="line">#include &lt;unistd.h&gt;</div>
<div class="line">#include &lt;string.h&gt;</div>
<div class="line">#include &lt;string&gt;</div>
<div class="line">#include &lt;iostream&gt;</div>
<div class="line">#include &lt;fstream&gt;</div>
<div class="line">#include &lt;typeinfo&gt;</div>
<div class="line">#include &quot;atmi/atmi++.hpp&quot;</div>
<div class="line"></div>
<div class="line">#include &quot;sample_fml_table.h&quot;</div>
<div class="line"></div>
<div class="line">class buffer_test : public atmi::abstract_client {</div>
<div class="line">  public:</div>
<div class="line">    buffer_test (): atmi::abstract_client (&quot;btest&quot;){</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    int run ( int argc, char **argv ){</div>
<div class="line">      try {</div>
<div class="line"></div>
<div class="line">        atmi::buffer b (100), a;</div>
<div class="line">        /*</div>
<div class="line">           const char *types[5] = { typeid(short).name(), typeid(int).name() };</div>
<div class="line">           std::cout &lt;&lt; &quot;Stored: &quot; &lt;&lt; types[0] &lt;&lt; std::endl;</div>
<div class="line">           std::cout &lt;&lt; &quot;Stored: &quot; &lt;&lt; types[1] &lt;&lt; &quot; is a &quot; &lt;&lt; std::endl;</div>
<div class="line">           if(strcmp ( typeid(int).name(), types[1]) == 0 ){</div>
<div class="line">           std::cout &lt;&lt; &quot;same type int.&quot; &lt;&lt; std::endl;</div>
<div class="line">           }</div>
<div class="line">           std::cout &lt;&lt; &quot;Type id &quot; &lt;&lt; typeid(long).name() &lt;&lt; std::endl;</div>
<div class="line">         */</div>
<div class="line"></div>
<div class="line">        std::cout &lt;&lt; &quot;atmi::buffer b: &quot; &lt;&lt; b.used() &lt;&lt; &quot;/&quot; &lt;&lt; b.unused() &lt;&lt;&quot;, size: &quot; &lt;&lt; b.size() &lt;&lt; &quot;, chksum: &quot; &lt;&lt; b.chksum() &lt;&lt;  std::endl;</div>
<div class="line"></div>
<div class="line">        atmi::Tfield&lt;atmi::carray&gt;   unknown_field;</div>
<div class="line">        unknown_field.set_id(SRVCDAY);</div>
<div class="line">        unknown_field.set_char_array(&quot;salut les amis\0rray&quot;, 19);</div>
<div class="line"></div>
<div class="line">        atmi::Tfield&lt;string&gt; prenom ( EMPNAME );</div>
<div class="line">        atmi::Tfield&lt;long&gt;   empid ( EMPID );</div>
<div class="line">        atmi::Tfield&lt;long&gt;   empzip ( EMPZIP );</div>
<div class="line">        atmi::Tfield&lt;string&gt; nom ( EMPNAME );</div>
<div class="line">        atmi::Tfield&lt;char *&gt; carray ( SRVCDAY );</div>
<div class="line">        atmi::Tfield&lt;char *&gt; copy ( SRVCDAY );</div>
<div class="line"></div>
<div class="line">        prenom = &quot;herbert&quot;;</div>
<div class="line">        nom = &quot;this is a char *&quot;;</div>
<div class="line">        empid = 2;</div>
<div class="line">        carray.set_char_array(&quot;hello world\0rray&quot;, 16);</div>
<div class="line"></div>
<div class="line">        std::cout &lt;&lt; &quot;--------------------------------------&quot; &lt;&lt; std::endl &lt;&lt; std::endl ;</div>
<div class="line">        std::cout &lt;&lt; &quot;Direct carray buffer access&quot; &lt;&lt; std::endl ;</div>
<div class="line">        // const char *direct_access = carray ;</div>
<div class="line">        // auto direct_access_length = carray.length();</div>
<div class="line"></div>
<div class="line">        for ( auto x = 0; x &lt; carray.length() ; x++ ){</div>
<div class="line">          // printf(&quot;%c - %c\n&quot;, direct_access[x], carray[x]);</div>
<div class="line">          printf(&quot;%c\n&quot;, carray[x]);</div>
<div class="line">        }</div>
<div class="line">        printf(&quot;\n&quot;);</div>
<div class="line">        carray[1] = &#39;X&#39; ;</div>
<div class="line">        printf(&quot;changed character 1 to X -&gt; %c\n&quot;, carray[1]);</div>
<div class="line"></div>
<div class="line">        std::cout &lt;&lt; &quot;--------------------------------------&quot; &lt;&lt; std::endl &lt;&lt; std::endl ;</div>
<div class="line">        std::cout &lt;&lt; &quot;copy carrays&quot; &lt;&lt; std::endl;</div>
<div class="line">        copy = carray;</div>
<div class="line"></div>
<div class="line">        std::cout &lt;&lt; &quot;--------------------------------------&quot; &lt;&lt; std::endl &lt;&lt; std::endl ;</div>
<div class="line">        std::cout &lt;&lt; &quot;Adding fields into FML buffer: &quot; &lt;&lt; std::endl;</div>
<div class="line">        b.add(unknown_field);</div>
<div class="line">        b.add ( empid );</div>
<div class="line">        b.add ( nom );</div>
<div class="line">        b.add ( prenom );</div>
<div class="line">        b.set ( carray );</div>
<div class="line">        b.print ();</div>
<div class="line">        std::cout &lt;&lt; &quot;--------------------------------------&quot; &lt;&lt; std::endl &lt;&lt; std::endl ;</div>
<div class="line"></div>
<div class="line">        std::cout &lt;&lt; &quot;get SRVCDAY value from FML buffer&quot; &lt;&lt; std::endl;</div>
<div class="line">        b.get ( copy );</div>
<div class="line">        std::cout &lt;&lt; &quot;there should be enough memory no re-allocation expected&quot; &lt;&lt; std::endl;</div>
<div class="line">        b.get ( copy );</div>
<div class="line"></div>
<div class="line">        std::cout &lt;&lt; &quot;--------------------------------------&quot; &lt;&lt; std::endl &lt;&lt; std::endl ;</div>
<div class="line"></div>
<div class="line">        copy.set_char_array(&quot;0123456789&quot;, 10);</div>
<div class="line">        std::cout &lt;&lt; &quot;buffer carray contains &quot; &lt;&lt; copy.length() &lt;&lt; &quot; characters&quot; &lt;&lt; std::endl ;</div>
<div class="line">        //b.remove(copy);</div>
<div class="line">        b.set(copy);</div>
<div class="line">        b.print();</div>
<div class="line"></div>
<div class="line">        atmi::Tfield&lt;char *&gt; resize_control ( SRVCDAY );</div>
<div class="line">        std::cout &lt;&lt; &quot;resize control initial carray length is  &quot; &lt;&lt; resize_control.length() &lt;&lt; std::endl;</div>
<div class="line">        resize_control.set_char_array(&quot;012345678901245678900123456789&quot;, 30);</div>
<div class="line">        b.get(resize_control);</div>
<div class="line"></div>
<div class="line">        std::cout &lt;&lt; &quot;de-allocate ressources&quot; &lt;&lt; std::endl ;</div>
<div class="line">        resize_control.free_ressources();</div>
<div class="line">        std::cout &lt;&lt; &quot;  firt call to get from buffer, size before call &quot; &lt;&lt; resize_control.length() &lt;&lt; std::endl ;</div>
<div class="line">        b.get(resize_control);</div>
<div class="line">        std::cout &lt;&lt; &quot;  second call to get from buffer, size before second call &quot; &lt;&lt; resize_control.length() &lt;&lt; std::endl ;</div>
<div class="line">        b.get(resize_control);</div>
<div class="line">        std::cout &lt;&lt; &quot;size is &quot; &lt;&lt; resize_control.length() &lt;&lt; &quot;, backend store size is &quot; &lt;&lt; resize_control.buffer_size() &lt;&lt; std::endl ;</div>
<div class="line"></div>
<div class="line">        std::cout &lt;&lt; &quot;--------------------------------------&quot; &lt;&lt; std::endl &lt;&lt; std::endl ;</div>
<div class="line">        std::cout &lt;&lt; copy.what() &lt;&lt; std::endl;</div>
<div class="line">        long len = 5;                  //copy.length();</div>
<div class="line">        char *cav = new char[len];</div>
<div class="line">        copy.get_char_array ( cav, len );</div>
<div class="line">        for ( int x = 0; x &lt; len; x++ ) {</div>
<div class="line">          std::cout &lt;&lt; &quot;&#39;&quot;&lt;&lt; cav[x]&lt;&lt;&quot;&#39;,&quot;;</div>
<div class="line">        }</div>
<div class="line">        std::cout &lt;&lt; std::endl;</div>
<div class="line"></div>
<div class="line">        std::cout &lt;&lt; &quot;Setting (update) empid value: &quot; &lt;&lt; std::endl;</div>
<div class="line">        empid = 22;</div>
<div class="line">        b.set ( empid );</div>
<div class="line">        b.print ();</div>
<div class="line"></div>
<div class="line">        std::cout &lt;&lt; &quot;size : &quot; &lt;&lt; b.size();</div>
<div class="line">        b.pack ();</div>
<div class="line">        std::cout &lt;&lt; &quot;, after pack: &quot; &lt;&lt; b.size() &lt;&lt; std::endl;</div>
<div class="line"></div>
<div class="line">        std::cout &lt;&lt; &quot;atmi::buffer (in the end): &quot; &lt;&lt; b.used() &lt;&lt; &quot;/&quot; &lt;&lt; b.unused() &lt;&lt;&quot;, size: &quot; &lt;&lt; b.size() &lt;&lt; &quot;, chksum: &quot; &lt;&lt; b.chksum() &lt;&lt;  std::endl;</div>
<div class="line"></div>
<div class="line">        std::cout &lt;&lt; &quot;wrapping atmi::buffer.&quot; &lt;&lt; std::endl ;</div>
<div class="line">        atmi::buffer wrapper ( b.get_buffer());</div>
<div class="line">        nom = &quot;this was added into a wrapper instance of atmi::buffer.&quot;;</div>
<div class="line">        wrapper.set (nom );</div>
<div class="line">        wrapper.print ();</div>
<div class="line"></div>
<div class="line">        std::cout &lt;&lt; &quot;transforming a atmi::buffer into a wrapped buffer.&quot; &lt;&lt; std::endl;</div>
<div class="line">        atmi::buffer wrapper1;</div>
<div class="line">        wrapper1.set_buffer ( wrapper.get_buffer());</div>
<div class="line">        prenom = &quot;this was set by a wrapper&quot;;</div>
<div class="line">        wrapper1.set ( prenom );</div>
<div class="line">        wrapper1.print();</div>
<div class="line"></div>
<div class="line">      }catch ( atmi::buffer_exception &amp;err ) {</div>
<div class="line">        cerr &lt;&lt; err.what() &lt;&lt; &quot;. Ferror : &quot; &lt;&lt; err.error() &lt;&lt;std::endl;</div>
<div class="line">      } catch ( atmi::atmi_exception &amp;err ) {</div>
<div class="line">        cerr &lt;&lt; err.what() &lt;&lt; std::endl;</div>
<div class="line">      } catch ( std::exception &amp;err ) {</div>
<div class="line">        cerr &lt;&lt; err.what() &lt;&lt; std::endl;</div>
<div class="line">      }</div>
<div class="line"></div>
<div class="line">      return 9999;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">};</div>
<div class="line"></div>
<div class="line">// program main -------------------------------------------------</div>
<div class="line"></div>
<div class="line">int main ( int argc, char **argv ) {</div>
<div class="line"></div>
<div class="line">  try {</div>
<div class="line"></div>
<div class="line">    std::cout &lt;&lt; &quot;atmi::buffer sample program (&quot; &lt;&lt; atmi::cpp_atmi_version() &lt;&lt;&quot;).&quot; &lt;&lt; std::endl;</div>
<div class="line">    buffer_test btest;</div>
<div class="line"></div>
<div class="line">    std::cout &lt;&lt; &quot;, starting up&quot; ;</div>
<div class="line">    btest.run ( argc, argv );</div>
<div class="line"></div>
<div class="line">  } catch ( atmi::atmi_exception &amp;err){</div>
<div class="line">    cerr &lt;&lt; std::endl &lt;&lt; err.what() &lt;&lt; std::endl;</div>
<div class="line">  } catch ( std::exception &amp;err ) {</div>
<div class="line">    cerr &lt;&lt; std::endl &lt;&lt; err.what() &lt;&lt; std::endl;</div>
<div class="line">  }</div>
<div class="line">  std::cout &lt;&lt; &quot;, done.&quot; &lt;&lt; std::endl;</div>
<div class="line"></div>
<div class="line">  return 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
